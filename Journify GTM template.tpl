___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Journify browser SDK",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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\u003d"
  },
  "description": "Capture \u0026 sync customer data to any marketing tool.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "tagType",
    "displayName": "Tag type",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "identify",
        "displayValue": "identify"
      },
      {
        "value": "group",
        "displayValue": "group"
      },
      {
        "value": "track",
        "displayValue": "track"
      },
      {
        "value": "page",
        "displayValue": "page"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "writeKey",
    "displayName": "Write Key",
    "simpleValueType": true,
    "notSetText": "Write key is required",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "userId",
    "displayName": "User ID",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ],
    "notSetText": "User ID is required",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "userTraits",
    "displayName": "User traits (optional)",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Trait key",
        "name": "traitKey",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Trait value",
        "name": "traitValue",
        "type": "TEXT"
      }
    ],
    "newRowButtonText": "Add Trait",
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "externalIdValue",
    "displayName": "External ID value (optional)",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "externalIdType",
    "displayName": "External ID type (optional)",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "externalIdCollection",
    "displayName": "External ID collection (optional)",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "groupId",
    "displayName": "Group ID",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "group",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "notSetText": "Group ID is required"
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "groupTraits",
    "displayName": "Group Traits (optional)",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Trait Key",
        "name": "traitKey",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Trait Value",
        "name": "traitValue",
        "type": "TEXT"
      }
    ],
    "newRowButtonText": "Add Group Trait",
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "group",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "eventName",
    "displayName": "Event name",
    "simpleValueType": true,
    "notSetText": "Event name is required",
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "eventProperties",
    "displayName": "Event Properties (optional)",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Property Key",
        "name": "propertyKey",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Property Value",
        "name": "propertyValue",
        "type": "TEXT"
      }
    ],
    "newRowButtonText": "Add property",
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "pageName",
    "displayName": "Page Name (optional)",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "pageProperties",
    "displayName": "Page Properties (optional)",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Property Key",
        "name": "propertyKey",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Property Value",
        "name": "propertyValue",
        "type": "TEXT"
      }
    ],
    "newRowButtonText": "Add Property",
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "cookieDomain",
    "displayName": "Cookie domain (optional)",
    "simpleValueType": true,
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "sessionDurationMin",
    "displayName": "Session duration in minutes (optional)",
    "simpleValueType": true,
    "canBeEmptyString": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const log = require('logToConsole');
const makeNumber = require('makeNumber');
const makeTableMap = require('makeTableMap');
const copyFromWindow = require('copyFromWindow');

// constants
const JS_URL = 'https://unpkg.com/@journifyio/js-sdk@latest/dist/_bundles/journifyio.min.js';
const LOG_PREFIX = '[Journify / GTM] ';
const JOURNIFY_WINDOW_KEY = 'journify';

// helpers

const fail = msg => {
    log(LOG_PREFIX + 'Error: ' + msg);
    return data.gtmOnFailure();
};

const onsuccess = () => {
    const journify = copyFromWindow(JOURNIFY_WINDOW_KEY);
    if (!journify) {
        return fail('Failed to load the window.journify');
    }

    load(journify);

    switch (data.tagType) {
        case 'identify':
            identify(journify);
            break;
        case 'group':
            group(journify);
            break;
        case 'track':
            track(journify);
            break;
        case 'page':
            page(journify);
            break;
    }

    data.gtmOnSuccess();
};

const load = (journify) => {
    if (!dataHasField("writeKey")) {
        return fail('`Write Key` setting is required when calling `load`');
    }

    const settings = {
        writeKey: data.writeKey,
    };

    if (dataHasField("cookieDomain")) {
        settings.cookie = {
            domain: data.cookieDomain,
        };
    }

    if (dataHasField("sessionDurationMin")){
        const sessionDurationMin = makeNumber(data.sessionDurationMin);
        if (typeof sessionDurationMin !== "undefined") {
            settings.sessionDurationMin = sessionDurationMin;
        }
    }

    journify.load(settings);
    log(LOG_PREFIX + 'Success: loading Journify SDK');
};

const identify = (journify) => {
    if (!dataHasField("userId")) {
        return fail('`User ID` setting is required when calling `identify`');
    }

    let traits = null;
    if (dataHasField("userTraits")) {
        traits = makeTableMap(data.userTraits || [], 'traitKey', 'traitValue');
    }

    let externalId = null;
    if (dataHasField("externalIdValue")) {
        externalId = {
            externalId: data.externalIdValue,
            type: data.externalIdType,
            collection: data.externalIdCollection,
        };
    }

    journify.identify(data.userId, traits,  externalId)
        .then((ctx) => log(LOG_PREFIX + 'Success: Journify Identify call, context', ctx))
        .catch((e) => fail(e));
};

const group = (journify) => {
    if (!dataHasField("groupId")) {
        return fail('`Group ID` setting is required when calling `group`');
    }

    let traits = null;
    if (dataHasField("groupTraits")) {
        traits = makeTableMap(data.groupTraits || [], 'traitKey', 'traitValue');
    }

    journify.group(data.groupId, traits)
        .then((ctx) => log(LOG_PREFIX + 'Success: Journify Group call, context', ctx))
        .catch((e) => fail(e));
};

const track = (journify) => {
    if (!dataHasField("eventName")) {
        return fail('`Event name` setting is required when calling `track`');
    }

    let properties = null;
    if (dataHasField("eventProperties")) {
        properties = makeTableMap(data.eventProperties || [], 'propertyKey', 'propertyValue');
    }

    journify.track(data.eventName, properties)
        .then((ctx) => log(LOG_PREFIX + 'Success: Journify Track call, context', ctx))
        .catch((e) => fail(e));
};

const page = (journify) => {
    let pageName = null;
    if (dataHasField("pageName")) {
        pageName = data.pageName;
    }

    let properties = null;
    if (dataHasField("pageProperties")) {
        properties = makeTableMap(data.pageProperties || [], 'propertyKey', 'propertyValue');
    }

    journify.page(pageName, properties)
        .then((ctx) => log(LOG_PREFIX + 'Success: Journify Page call, context', ctx))
        .catch((e) => fail(e));
};

const dataHasField = (fieldKey) => {
    const val = data[fieldKey];
    return val && val.length > 0;
};

const onfailure = () => {
    return fail('Failed to load the Journify JavaScript library');
};


injectScript(JS_URL, onsuccess, onfailure, 'journify');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "journify"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://unpkg.com/@journifyio/js-sdk@latest/dist/_bundles/journifyio.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 3/28/2023, 1:47:47 PM


